rules_version = '2';

  match /databases/{database}/documents {
    // Restrict to authenticated users only
    match /archive/{document=**} {
      allow read: if request.auth != null && 
                    (resource.data.userId == request.auth.uid || 
                     resource.data.userId == null);  // Legacy docs
      allow write: if request.auth != null && 
                     request.resource.data.userId == request.auth.uid;
    }
    
    match /memoria/{document=**} {
      allow read: if request.auth != null && 
                    (resource.data.userId == request.auth.uid || 
                     resource.data.userId == null);  // Legacy docs
      allow write: if request.auth != null && 
                     request.resource.data.userId == request.auth.uid;
    }
  }
}
